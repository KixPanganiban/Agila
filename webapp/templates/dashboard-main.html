{% extends "dashboard.html" %}
{% load static %}
{% block dashboard_content %}
<h4>Your Devices</h4>
<table class="table table-striped table-hover">
	<thead>
		<th>Last Status</th>
		<th>Device Type</th>
		<th>Model</th>
		<th>OS</th>
		<th>Mac Address</th>
		<th>Unlink</th>
	</thead>
	<tbody>
		{% if devices.count < 1 %}
		<tr><td colspan="6"><center>You have not yet linked any devices. Link one now!</center></td></tr>
		{% endif %}
		{% for device in devices %}
		<tr>
			<td><span class="label {{device.statusclass}}">{{device.status}}</span></td>
			<td>{{device.device}}</td>
			<td>{{device.model}}</td>
			<td>{{device.os}}</td>
			<td>{{device.mac}}</td>
			<td><a href="#" class="text-danger">Unlink</a></td>
		</tr>
		{% endfor %}
	</tbody>
</table>
<div class="pull-right">
	<a href="javascript: $('#link-modal').modal();" class="btn btn-success">Link {% if devices.count > 0 %}Another{% endif %} One</a>
</div>
<h4>Your Communities</h4>
<table class="table table-striped table-hover">
	<thead>
		<th>Group Name</th>
		<th>Members</th>
		<th>Total Consumption</th>
		<th>Global Rank</th>
	</thead>
	<tbody>
		{% if groups.count < 1 %}
		<tr>
			<td colspan="4"><center>You have not yet joined any communities. Join one now!</center></td>
		</tr>
		{% endif %}
		{% for group in groups %}
		<tr>
			<td>{{group.group.name}}</td>
			<td>0</td>
			<td>0</td>
			<td>1st</td>
		</tr>
		{% endfor %}
	</tbody>
</table>
<div class="pull-right">
	<a href="javascript: $('#community-modal').modal();" class="btn btn-success">Join {% if groups.count > 0 %}Another{% endif %} One</a>
</div>
<div class="modal" id="link-modal">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				<h4 class="modal-title">Link a new device</h4>
			</div>
			<div class="modal-body">
				<div style="text-align: center;">
					<form action="/link/" method="POST">
						{% csrf_token %}
						<p>Input the 6-digit code generated by your device:</p>
						<input type="text" class="form-control input-lg" name="code" style="text-align: center;"/>
						<input type="submit" class="form-control btn  btn-success" value="Link"/>
						<hr/>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="modal" id="community-modal">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				<h4 class="modal-title">Join a community</h4>
			</div>
			<div class="modal-body">
				<div style="text-align: center;">
					<form action="/join_community/" method="POST">
						{% csrf_token %}
						<div class="form-group">
							<label for="community">Enter the name of the community that you want to join:</label>
							<div class="input-group">
								<input class="form-control" name="community" id="community"/>
								<span class="input-group-btn">
								<input type="submit" class="btn  btn-success" value="Join"/>
								</span>
							</div>
							<hr/>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	{% endblock %}
	{% block js%}
	<script type="text/javascript">
		$(document).ready(function() {
		var substringMatcher = function(strs) {
		return function findMatches(q, cb) {
		var matches, substringRegex;
		matches = [];
		substrRegex = new RegExp(q, 'i');
		$.each(strs, function(i, str) {
		if (substrRegex.test(str)) {
		matches.push({ value: str });
		}
		});
		cb(matches);
		};
		};
		{% autoescape off %}
		var communities = {{groups_json}};
		{% endautoescape %}
			$("#community").typeahead({
				minlength: 1
			}, {
				name: 'communities',
				source: substringMatcher(communities)
			});
		});
	</script>
	{% endblock %}